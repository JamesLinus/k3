<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <title>Chapter&nbsp;2.&nbsp;Language Reference</title><link rel="stylesheet" href="css/docbook.css" type="text/css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.75.2"><link rel="home" href="user_documentation.html" title="K3 User Documentation"><link rel="up" href="user_documentation.html" title="K3 User Documentation"><link rel="prev" href="ch01.html" title="Chapter&nbsp;1.&nbsp;Presentation"><link rel="next" href="ch02s02.html" title="2.2.&nbsp;Advanced"><base xmlns:fo="http://www.w3.org/1999/XSL/Format" target="body"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;2.&nbsp;Language Reference</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch01.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch02s02.html">Next</a></td></tr></table><hr></div><div class="chapter" title="Chapter&nbsp;2.&nbsp;Language Reference"><div class="titlepage"><div><div><h2 class="title"><a name="_language_reference"></a>Chapter&nbsp;2.&nbsp;Language Reference</h2></div></div></div><div class="section" title="2.1.&nbsp;Basic"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_basic"></a>2.1.&nbsp;Basic</h2></div></div></div><div class="section" title="2.1.1.&nbsp;Creating an aspect on a class"><div class="titlepage"><div><div><h3 class="title"><a name="_creating_an_aspect_on_a_class"></a>2.1.1.&nbsp;Creating an aspect on a class</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">Add the annotation <span class="emphasis"><em><span class="strong"><strong>Aspect</strong></span></em></span> on the class corresponding to the aspect</li><li class="listitem">Specify the class to augment using the annotation parameter <span class="strong"><strong>className</strong></span></li><li class="listitem">Update the imported packages using <span class="strong"><strong>ctrl+shift+o</strong></span></li></ol></div><p>Let&#8217;s start from a classic class <span class="emphasis"><em>Foo</em></span> that we will extend with aspects.</p><pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">package</b> mypackage
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> Foo{
    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">def</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">void</b> hello(){
        println(<i xmlns:fo="http://www.w3.org/1999/XSL/Format" style="color:blue" class="hl-string">"Hello from Foo"</i>)
    }
}</pre><p>now we will add a aspect on it.</p><pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">package</b> mypackage

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> fr.inria.triskell.k3.Aspect

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> mypackage.Foo

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color: darkred">@Aspect(className=Foo)</b>
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> FooAspect {
    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">def</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">void</b> display (){
         prinln(<i xmlns:fo="http://www.w3.org/1999/XSL/Format" style="color:blue" class="hl-string">"I am FooAspect"</i>)
    }
}</pre><p>In an aspect you can use the attributes and operations of both the augmented class and the aspect itself.</p><p>In aspects <span class="strong"><strong>the keyword</strong></span> "<span class="emphasis"><em><span class="strong"><strong>this</strong></span></em></span>" <span class="strong"><strong>must not be used</strong></span>.
Instead, the keyword "<span class="strong"><strong>_self</strong></span>" must be used.</p><pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color: darkred">@Aspect(className=BaseClass)</b>
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> BaseClassAspect {
    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">int</b> anInteger = <span class="hl-number">1</span>

    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">def</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">void</b> display (){
         <i xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-comment" style="color: darkgreen">// The keyword _self must be used to refer to attributes and operations of the class and aspect.</i>
         <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">_self</b>.anInteger = <span class="hl-number">2</span>
         <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">_self</b>.hello()
    }
}</pre><p>Despite it should be legal, due to a bug in xtend, we <span class="strong"><strong>do not</strong></span> recommand the following syntax:</p><pre class="programlisting">@Aspect(className=typeof(OtherClass))</pre><p>It may raise strange scope issue, especially in case of aspects defined in several packages.</p></div><div class="section" title="2.1.2.&nbsp;Using aspect from another k3/xTend program"><div class="titlepage"><div><div><h3 class="title"><a name="_using_aspect_from_another_k3_xtend_program"></a>2.1.2.&nbsp;Using aspect from another k3/xTend program</h3></div></div></div><p>To use the aspect, you need to import the correct classes and indicates to xTend thant some additionnal feautres can come from the aspect.</p><p>This is done using the special import <span class="strong"><strong>import static extension</strong></span> which enable the use of the additions declared in the aspect.</p><pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">package</b> mypackage

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> mypackage.Foo
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> mypackage.FooAspect

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">extension</b> mypackage.FooAspect.*

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> Main {
    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">def</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">void</b> main(){
      <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">val</b> Foo f1 = <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">new</b> Foo
      f1.display()
    }
}</pre><p>TODO: ajouter dans un callout To use the operations and attributes added in a class, you have to import the aspect:
<span class="emphasis"><em>import static extension myPkg.AspectName.*</em></span></p><div class="section" title="2.1.2.1.&nbsp;Disambiguisation"><div class="titlepage"><div><div><h4 class="title"><a name="_disambiguisation"></a>2.1.2.1.&nbsp;Disambiguisation</h4></div></div></div><p>If several operations or attributes have similar names, xTend may not find the expected feature.
In that case you need to disambiguise the call by accessing the underlying helper class.</p><p><span class="emphasis"><em>* TODO *</em></span> show an example of direct, non ambiguious call using the underlying helper class.</p><pre class="screen">Be careful when cleaning unused imports while your programs isn't complete (for example using **ctrl+shift+o**) because it will also removed unused static extension and will disable the code completion (**ctrl+space**) for the features of these aspects.</pre></div></div><div class="section" title="2.1.3.&nbsp;Extending an aspect (classic inheritance)"><div class="titlepage"><div><div><h3 class="title"><a name="_extending_an_aspect_classic_inheritance"></a>2.1.3.&nbsp;Extending an aspect (classic inheritance)</h3></div></div></div><p>Extending an aspect can be performed as in Xtend.</p><p>Let&#8217;s consider the class <span class="emphasis"><em>Bar</em></span> that inherits from <span class="emphasis"><em>Foo</em></span></p><p>Let&#8217;s start from a classic class <span class="emphasis"><em>Foo</em></span> that we will extend with aspects.</p><pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">package</b> mypackage
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> Bar <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">extends</b> Foo{
    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">def</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">void</b> hello(){
        println(<i xmlns:fo="http://www.w3.org/1999/XSL/Format" style="color:blue" class="hl-string">"Hello from Bar"</i>)
    }
}</pre><p>However, as for Java, an aspect can directly inherit from only one aspect!</p><pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">package</b> mypackage

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> fr.inria.triskell.k3.Aspect
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> fr.inria.triskell.k3.OverrideAspectMethod

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> mypackage.Foo
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> mypackage.Bar

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">import</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">static</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">extension</b> mypackage.FooAspect.*

<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color: darkred">@Aspect(className=Bar)</b>
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> BarAspect <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">extends</b> FooAspect {
    <i xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-comment" style="color: darkgreen">// Annotation to tag the operation as an operation overloading a super operation</i>
    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color: darkred">@OverrideAspectMethod</b>
    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">def</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">void</b> display(){
      println(<i xmlns:fo="http://www.w3.org/1999/XSL/Format" style="color:blue" class="hl-string">"I am BarAspect"</i>)
    }
}</pre></div><div class="section" title="2.1.4.&nbsp;Calling a super operation"><div class="titlepage"><div><div><h3 class="title"><a name="_calling_a_super_operation"></a>2.1.4.&nbsp;Calling a super operation</h3></div></div></div><p>A call to a super operation can be done by writing <span class="strong"><strong>super_</strong></span> followed by the name of the operation. Do not forget to use <span class="strong"><strong>_self</strong></span> to handle elements of the class or aspect.</p><pre class="programlisting"><b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color: darkred">@Aspect(className=MyClass)</b>
<b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">class</b> MyClassAspect <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">extends</b> OtherClassAspect {
    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color: darkred">@OverrideAspectMethod</b>
    <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">def</b> <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">void</b> display(){
       <b xmlns:fo="http://www.w3.org/1999/XSL/Format" class="hl-keyword" style="color:darkblue">_self</b>.super_display()
       prinln(<i xmlns:fo="http://www.w3.org/1999/XSL/Format" style="color:blue" class="hl-string">"I am MyClassAspect"</i>)
    }
}</pre></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch01.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch02s02.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;1.&nbsp;Presentation&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="user_documentation.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;2.2.&nbsp;Advanced</td></tr></table></div></body></html>